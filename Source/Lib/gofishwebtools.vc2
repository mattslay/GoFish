*--------------------------------------------------------------------------------------------------------------------------------------------------------
* (ES) AUTOGENERADO - ¡¡ATENCIÓN!! - ¡¡NO PENSADO PARA EJECUTAR!! USAR SOLAMENTE PARA INTEGRAR CAMBIOS Y ALMACENAR CON HERRAMIENTAS SCM!!
* (EN) AUTOGENERATED - ATTENTION!! - NOT INTENDED FOR EXECUTION!! USE ONLY FOR MERGING CHANGES AND STORING WITH SCM TOOLS!!
*--------------------------------------------------------------------------------------------------------------------------------------------------------
*< FOXBIN2PRG: Version="1.19" SourceFile="gofishwebtools.vcx" /> (Solo para binarios VFP 9 / Only for VFP 9 binaries)
*
*
DEFINE CLASS gf_webcontrol AS container 
 	*< CLASSDATA: Baseclass="container" Timestamp="" Scale="Pixels" Uniqueid="" />

	*-- OBJECTDATA items order determines ZOrder / El orden de los items OBJECTDATA determina el ZOrder 
	*< OBJECTDATA: ObjPath="oBrowser" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdZoomIn" UniqueID="" Timestamp="" />
	*< OBJECTDATA: ObjPath="cmdZoomOut" UniqueID="" Timestamp="" />

	*<DefinedPropArrayMethod>
		*m: cursortohtml
		*m: navigatetoblankpage
		*m: showhtml
		*m: showhtmlfile
		*m: zoom
		*p: lgooglechromeframe
		*p: nzoom
		*p: nzoominfactor
		*p: nzoomoutfactor
		*p: _memberdata		&& XML Metadata for customizable properties
	*</DefinedPropArrayMethod>

	Height = 200
	lgooglechromeframe = .F.
	Name = "gf_webcontrol"
	nzoom = 0
	nzoominfactor = 1.1
	nzoomoutfactor = 0.9
	Width = 200
	_memberdata = <VFPData>
		<memberdata name="showhtml" display="ShowHtml"/>
		<memberdata name="showhtmlfile" display="ShowHtmlFile"/>
		<memberdata name="zoom" display="Zoom"/>
		<memberdata name="navigatetoblankpage" display="NavigateToBlankPage"/>
		<memberdata name="nzoom" display="nZoom"/>
		<memberdata name="nzoominfactor" display="nZoomInFactor"/>
		<memberdata name="nzoomoutfactor" display="nZoomOutFactor"/>
		<memberdata name="cursortohtml" display="CursorToHtml"/>
		<memberdata name="lgooglechromeframe" display="lGoogleChromeFrame"/>
		</VFPData>		&& XML Metadata for customizable properties

	ADD OBJECT 'cmdZoomIn' AS commandbutton WITH ;
		Anchor = 8, ;
		Caption = "+", ;
		FontSize = 11, ;
		Height = 20, ;
		Left = 148, ;
		Name = "cmdZoomIn", ;
		Top = 1, ;
		Width = 24
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'cmdZoomOut' AS commandbutton WITH ;
		Anchor = 8, ;
		Caption = "-", ;
		FontSize = 11, ;
		Height = 20, ;
		Left = 174, ;
		Name = "cmdZoomOut", ;
		Top = 1, ;
		Width = 24
		*< END OBJECT: BaseClass="commandbutton" />

	ADD OBJECT 'oBrowser' AS olecontrol WITH ;
		Anchor = 15, ;
		Height = 177, ;
		Left = 1, ;
		Name = "oBrowser", ;
		Top = 22, ;
		Width = 198
		*< END OBJECT: BaseClass="olecontrol" OLEObject="c:\windows\syswow64\ieframe.dll" Value="0M8R4KGxGuEAAAAAAAAAAAAAAAAAAAAAPgADAP7/CQAGAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAEAAAAgAAAAEAAAD+////AAAAAAAAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9/////v////7////+/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////1IAbwBvAHQAIABFAG4AdAByAHkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAUA//////////8BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJBPCQUyV80BAwAAAEABAAAAAAAAAwBPAGwAZQBPAGIAagBlAGMAdABEAGEAdABhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB4AAgEDAAAAAgAAAP////8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArAAAAAAAAAADAEEAYwBjAGUAcwBzAE8AYgBqAFMAaQB0AGUARABhAHQAYQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJgACAP///////////////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAA4AAAAAAAAAAMAQwBoAGEAbgBnAGUAZABQAHIAbwBwAHMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAIA////////////////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAQAAAAAAAAAAwAAAP7////+////BAAAAP7///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9h+VaICjTQEalrAMBP1wWiTAAAAHcUAABLEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAOAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAA4NBXAHM1zxGuaQgAKy4SYggAAAAAAAAATAAAAAEUAgAAAAAAwAAAAAAAAEaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==" />
	
	PROCEDURE cursortohtml
		* Generates an HTML table from a Foxpro table or cursor.
		* The resulting string is a formatted HTML table which 
		* can be inserted into a web page. Each column represents 
		* a field from the cursor. The first row contains the 
		* field names (in proper case, with underscores converted 
		* to spaces).
		
		* Parameter:
		* tcAalias: Alias of table or cusor, which
		* must already be open. The parameter is 
		* mandatory.
		*
		* Original code from : http://www.ml-consult.co.uk/foxst-13.htm
		* Modifications by Matt Slay, 2011
		
		LPARAMETER tcAlias, tcTableId, tcTableClass, tcZeroString
		
		LOCAL lcRetVal, lnI, lcColHead, lcCell
		
		* Check the parameters (these two lines require SET ASSERT ON)
		ASSERT PCOUNT()>0 MESSAGE "Parameter required"
		ASSERT USED(tcAlias) ;
		  MESSAGE "Alias "+tcAlias+" not found"
		
		SELECT (tcAlias)
		
		tcTableId = Evl(tcTableId, '')
		tcTableClass = Evl(tcTableClass, '')
		tcZeroString= Evl(tcZeroString, '')  
		
		*-- Define the table -------------------
		lcRetVal = '<TABLE id = "' + tcTableId + '" class="' + tcTableClass + '">'
		
		*-- Insert column headings from field names
		lcRetVal = lcRetVal + "<TR>"
		FOR lnI = 1 to FCOUNT()
		  lcColHead = PROPER(STRTRAN(FIELD(lnI),"_"," "))
		  lcRetVal = lcRetVal +"<TH>"+lcColHead + "</TH>"
		ENDFOR
		lcRetVal = lcRetVal + "</TR>"
		
		*-- Scan the cursor, creating a row for each record
		SCAN
		  lcRetVal = lcRetVal + "<TR>"
		  FOR lnI = 1 TO FCOUNT()
		    lcCell = TRANSFORM(EVALUATE(FIELDS(lnI)))
		    If lcCell == '0'
		     lcCell = tcZeroString
		    EndIf
		    lcRetVal = lcRetVal + "<TD>" + lcCell + "</TD>"
		  ENDFOR
		  lcRetVal = lcRetVal + "</TR>"
		ENDSCAN
		
		*-- End the table
		lcRetVal = lcRetVal + "</TABLE>"
		
		RETURN lcRetVal
		
	ENDPROC

	PROCEDURE navigatetoblankpage
		Local lnLoadTimeout, lnStartSeconds, loBrowser
		
		lnLoadTimeout = 3       && seconds
		loBrowser = This.oBrowser
		
		*-- Clear the current page ------------------------------------
		
			loBrowser.Object.Navigate("about:blank")
		
			lnStartSeconds = Seconds() && Wait for load completion
			
			Do While loBrowser.ReadyState <> 4 And (Seconds() - lnStartSeconds <= lnLoadTimeout )
				DoEvents
			EndDo 
			
		
	ENDPROC

	PROCEDURE showhtml
		Lparameters tcHtml
		
		*-- From: http://www.berezniker.com/content/pages/visual-foxpro/loading-html-web-browser-control-variable
		lnLoadTimeout = 3       && seconds
		
		loBrowser = This.obrowser
		
			This.NavigateToBlankPage()
		
			If Empty(tcHtml)
				Return
			Endif
			
			loBrowser.Object.Document.Open()
			loBrowser.Object.Document.Write(tcHtml)
			loBrowser.Object.Document.Close()
			This.Zoom(1)
		
			lnStartSeconds = Seconds()
		
			Do While loBrowser.ReadyState <> 4 ;
					And (Seconds() - lnStartSeconds <= lnLoadTimeout )
				DoEvents
			EndDo
			
		
	ENDPROC

	PROCEDURE showhtmlfile
		Lparameters tcHtmlFile
		
		*-- From: http://www.berezniker.com/content/pages/visual-foxpro/loading-html-web-browser-control-variable
		lnLoadTimeout = 3       && seconds
		
		loBrowser = This.oBrowser
		
			This.NavigateToBlankPage()
		
			If !File(tcHtmlFile)
				Return
			Endif
			
			*--- Load the passed in file ----------------------------------
			
			lcURL = 'file:' + Chr(47) + Chr(47) + tcHtmlFile
			
			*-- See: http://weblogs.foxite.com/bernardbout/2012/01/07/html5-with-internet-explorer-8-in-vfp/
			If this.lGoogleChromeFrame = .t.
				lcUrl = 'gcf:' + lcURL 
			Endif
		
			loBrowser.Object.Navigate(lcUrl)
			This.Zoom(1)
		
			lnStartSeconds = Seconds()
		
			Do While loBrowser.ReadyState <> 4 ;
					And (Seconds() - lnStartSeconds <= lnLoadTimeout )
				DoEvents
			EndDo
			
		
	ENDPROC

	PROCEDURE zoom
		Lparameters tnZoomFactor
		
		Local lnZoom
		
		Try
			lnZoom = Evl(This.nZoom, 1)
			lnZoom = lnZoom * tnZoomFactor
			This.obrowser.Document.Body.Style.zoom = Transform(lnZoom)
			This.nZoom = lnZoom
		Catch
		EndTry
		
		
		  
	ENDPROC

	PROCEDURE cmdZoomIn.Click
		This.parent.Zoom(This.Parent.nZoomInFactor)
		
	ENDPROC

	PROCEDURE cmdZoomOut.Click
		This.parent.Zoom(This.Parent.nZoomOutFactor)
		
	ENDPROC

ENDDEFINE
